# Variables del proyecto principal
NAME = push_swap
HEADER = ../push_swap.h

LDFLAGS = -no-pie
CFLAGS = -Wall -Wextra -Werror
CC = gcc
RM = rm -f
DEBUG = -g

LIBFTDIR = ../incl/libft
LIBPRINTFDIR = ../incl/libft/printf

SRCS = $(wildcard ../*.c)
OBJS = $(../SRCS:.c=.o)

# Variables de testing
TEST_NAME = test_push_swap
TEST_SRCS = main.c
TEST_OBJS = ${TEST_SRCS:.c=.o}

# Variables de Unity (asumiendo que tienes unity.c y unity.h en ./tests/Unity)
UNITY_DIR = ./tests/Unity
UNITY_FILES = $(UNITY_DIR)/src/unity.c

# Banderas de compilaci√≥n para Unity
CFLAGS += -I$(UNITY_DIR)

all: ${NAME}

%.o: %.c ${HEADER} Makefile
	@${CC} ${CFLAGS} -c $< -o $@

${NAME}: $(OBJS)
	@make -C ${LIBFTDIR}
	@make -C ${LIBPRINTFDIR}
	@${CC} ${CFLAGS} ${OBJS} ${TEST_SRCS} ${LIBFTDIR}/libft.a ${LIBPRINTFDIR}/libftprintf.a -o ${NAME} ${LDFLAGS}

# Reglas para tests con Unity
test: $(TEST_OBJS) $(OBJS) $(UNITY_FILES)
	@make -C ${LIBFTDIR}
	@make -C ${LIBPRINTFDIR}
	@${CC} ${CFLAGS} ${TEST_OBJS} $(UNITY_FILES) ${OBJS} ${LIBFTDIR}/libft.a ${LIBPRINTFDIR}/libftprintf.a -o ${TEST_NAME} ${LDFLAGS}
	@./${TEST_NAME}

testgdb: $(TEST_OBJS) $(OBJS) $(UNITY_FILES)
	@make -C ${LIBFTDIR}
	@make -C ${LIBPRINTFDIR}
	@${CC} ${CFLAGS} ${DEBUG} ${TEST_OBJS} $(UNITY_FILES) ${OBJS} ${LIBFTDIR}/libft.a ${LIBPRINTFDIR}/libftprintf.a -o ${TEST_NAME} ${LDFLAGS}
	@./${TEST_NAME}

clean:
	@cd ${LIBFTDIR} && ${MAKE} clean
	@cd ${LIBPRINTFDIR} && ${MAKE} clean
	@$(RM) $(OBJS) $(TEST_OBJS)

fclean: clean
	@$(RM) $(NAME) $(TEST_NAME)

re: fclean all

.PHONY: all clean fclean re test

